# KingBase 数据库配置说明

## 1. 驱动文件放置

### 文件位置
```
NBcompany_S-final/
├── lib/
│   └── kingbase8-9.0.0.jar    # KingBase 驱动文件
├── src/
├── pom.xml
└── ...
```

### 操作步骤
1. 将 `kingbase8-9.0.0.jar` 文件复制到项目根目录下的 `lib/` 文件夹中
2. 如果 `lib/` 文件夹不存在，请先创建

## 2. Maven 配置 (pom.xml)

### 依赖配置
```xml
<!-- KingBase 数据库驱动 -->
<dependency>
    <groupId>com.kingbase8</groupId>
    <artifactId>kingbase8</artifactId>
    <version>9.0.0</version>
    <scope>system</scope>
    <systemPath>${project.basedir}/lib/kingbase8-9.0.0.jar</systemPath>
</dependency>
```

### 说明
- `scope=system`: 表示使用本地 jar 文件
- `systemPath`: 指定本地 jar 文件的路径
- `version`: 与你的驱动文件版本保持一致

## 3. 数据库配置 (application.properties)

### 基础配置
```properties
# KingBase 数据库配置
spring.datasource.url=jdbc:kingbase8://120.27.144.229:54321/leon0?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true
spring.datasource.username=nbdb
spring.datasource.password=a050708b
spring.datasource.driver-class-name=com.kingbase8.Driver
```

### 连接池配置
```properties
# 连接池配置
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
```

### 配置参数说明

#### 数据库连接 URL 参数
- `jdbc:kingbase8://`: KingBase 数据库协议
- `120.27.144.229`: 数据库服务器地址
- `54321`: 数据库端口号
- `leon0`: 数据库名称
- `useUnicode=true`: 使用 Unicode 编码
- `characterEncoding=utf8`: 字符编码为 UTF-8
- `serverTimezone=Asia/Shanghai`: 服务器时区
- `useSSL=false`: 不使用 SSL 连接
- `allowPublicKeyRetrieval=true`: 允许公钥检索

#### 连接池参数
- `maximum-pool-size=20`: 最大连接池大小
- `minimum-idle=5`: 最小空闲连接数
- `connection-timeout=30000`: 连接超时时间 (30秒)
- `idle-timeout=600000`: 空闲连接超时时间 (10分钟)
- `max-lifetime=1800000`: 连接最大生命周期 (30分钟)

## 4. 数据库表结构适配

### 注意事项
由于从 MySQL 切换到 KingBase，需要注意以下差异：

#### 1. 数据类型映射
```sql
-- MySQL -> KingBase
BIGINT -> BIGINT
VARCHAR -> VARCHAR
TEXT -> TEXT
DATETIME -> TIMESTAMP
TINYINT -> SMALLINT
```

#### 2. 自增主键语法
```sql
-- MySQL
id BIGINT NOT NULL AUTO_INCREMENT

-- KingBase
id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY
```

#### 3. 时间戳默认值
```sql
-- MySQL
created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP

-- KingBase
created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
```

## 5. 测试连接

### 启动应用
```bash
mvn clean compile
mvn spring-boot:run
```

### 检查日志
启动后查看控制台日志，确认：
1. 数据库连接成功
2. 没有驱动相关的错误
3. MyBatis 映射器加载正常

### 常见问题排查

#### 1. 驱动找不到
```
java.lang.ClassNotFoundException: com.kingbase8.Driver
```
**解决方案：**
- 确认 jar 文件已放在 `lib/` 目录下
- 确认 pom.xml 中的 `systemPath` 路径正确
- 重新执行 `mvn clean compile`

#### 2. 连接失败
```
java.sql.SQLException: Connection refused
```
**解决方案：**
- 检查数据库服务器地址和端口
- 确认数据库服务正在运行
- 检查防火墙设置

#### 3. 认证失败
```
java.sql.SQLException: Authentication failed
```
**解决方案：**
- 检查用户名和密码是否正确
- 确认用户有访问数据库的权限

## 6. 数据库初始化

### 创建数据库表
如果 KingBase 数据库中还没有表，需要执行初始化 SQL：

```sql
-- 使用 KingBase 语法创建表
CREATE TABLE sys_company (
    id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    company_name VARCHAR(100) NOT NULL,
    contact_person VARCHAR(50),
    contact_phone VARCHAR(20),
    contact_email VARCHAR(100),
    status SMALLINT NOT NULL DEFAULT 1,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
);

-- 其他表结构类似...
```

## 7. 性能优化建议

### 1. 连接池调优
根据实际并发量调整连接池参数：
```properties
# 高并发场景
spring.datasource.hikari.maximum-pool-size=50
spring.datasource.hikari.minimum-idle=10

# 低并发场景
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
```

### 2. 查询优化
- 为常用查询字段添加索引
- 使用分页查询避免大量数据返回
- 合理使用 MyBatis 的缓存机制

## 8. 监控和维护

### 连接池监控
```properties
# 启用连接池监控
logging.level.com.zaxxer.hikari=DEBUG
```

### 数据库性能监控
- 监控连接池使用情况
- 监控 SQL 执行时间
- 定期检查数据库连接状态

## 总结

1. **驱动文件**: 放在 `lib/kingbase8-9.0.0.jar`
2. **Maven 配置**: 使用 `system` scope 引用本地 jar
3. **数据库配置**: 修改 `application.properties` 中的连接信息
4. **表结构**: 注意 KingBase 和 MySQL 的语法差异
5. **测试**: 启动应用验证连接是否正常

按照以上配置，你的 Spring Boot 应用就可以正常连接 KingBase 数据库了。 